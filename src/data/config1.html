<h2 class="content-subhead">TeleInfo<span id="l1"><h6 style="display:inline"><b> Loading...</b></h6></span></h2>
<form class="pure-form pure-form-aligned" id='f1'>
    <fieldset>

<h3 class="content-subhead">Home Automation  <span id="hai" name="hai" class="infotip">?</span></h3>
<div class="infotipdiv"  id="haidiv" name="haidiv" style="display:none;">
    HTTP GET request can be send to this device : <br>
    <b>http://$ip$/getAllLabel</b> : Get list of all labels (JSON List)<br>
    <b>http://$ip$/getLabel?name=$labelName$</b> : Get last value of a label, ex : PAPP (JSON)<br>
</div>

<div class="pure-control-group">
    <label for="haproto">Type</label>
    <select id='haproto' name='haproto'>
        <option value="0">Disabled</option>
        <option value="1">HTTP</option>
        <option value="2">MQTT</option>
    </select>
</div>


<div id='hae' style='display:none'>

    <div class="pure-control-group">
        <label for="hatls">SSL/TLS</label>
        <input type='checkbox' id='hatls' name='hatls'>
    </div>
    <div class="pure-control-group">
        <label for="hahost">Hostname</label>
        <input type='text' id='hahost' name='hahost' maxlength='64' pattern='[A-Za-z0-9-.]+' size='50' placeholder="IP or DNS Name">
        <span class="pure-form-message-inline">(Hostname should match with certificate name if SSL/TLS is enabled)</span>
    </div>
    <div class="pure-control-group">
        <label for="haupperiod">Upload Period (s)</label>
        <input type='number' id='haupperiod' name='haupperiod' min='0' max='65535' placeholder="0=realtime">
    </div>

    <div id='hahe'>

        <div class="pure-control-group">
            <label for="hahtype">Type</label>
            <select id='hahtype' name='hahtype'>
                <option value="0">Generic</option>
                <option value="1">Jeedom TeleInfo Plugin</option>
            </select>
        </div>

        <div id='hahtlse'>
            <div class="pure-control-group">
                <label for="hahfp">TLS FingerPrint</label>
                <input type='text' id='hahfp' name='hahfp' maxlength='59' pattern='^([0-9A-Fa-f]{2}[ :-]*){19}([0-9A-Fa-f]{2})$' size='65'>
                <span class="pure-form-message-inline">(separators are : &lt;none&gt;,&lt;space&gt;,:,-)</span>
            </div>
        </div>

        <div id='hah0'>
            <div class="pure-control-group">
                <label for="hahgup">URI Pattern</label>
                <input type='text' id='hahgup' name='hahgup' maxlength='150' size='65' placeholder="Used to generate requests URI">
                <span id="hahgupi" name="hahgupi" class="infotip">?</span>
            </div>

            <div class="pure-control-group" id="hahgupidiv" name="hahgupidiv" style="display:none;">
                <label></label>
                <div class="infotipdiv">
                    URI Pattern placeholders : <br>
                    <b>$tls$</b> : replaced by 's' for HTTPS connection<br>
                    <b>$host$</b> : replaced by hostname<br>
                    <b>$adco$</b> : replaced the counter Serial Number<br>
                    <b>$label$</b> : replaced the current label<br>
                    <b>$val$</b> : replaced the value of the current label<br>
                    Ex : http<b>$tls$</b>://<b>$host$</b>/api/pushValue?id=<b>$label$</b>&amp;value=<b>$val$</b>
                </div>
            </div>
        </div>

        <div id='hah1'>
            <div class="pure-control-group">
                <label for="hahjak">ApiKey</label>
                <input type='password' id='hahjak' name='hahjak' maxlength='48' pattern='[A-Za-z0-9-.]+' size=50 title='APIKey from Jeedom configuration webpage'>
            </div>
        </div>

    </div>

    <div id='hame'>

        <div class="pure-control-group">
            <label for="hamtype">Type</label>
            <select id='hamtype' name='hamtype'>
                <option value="0">Generic</option>
            </select>
            <span id="hamtype0i" name="hamtype0i" class="infotip">?</span>
        </div>
        <div class="pure-control-group" id="hamtype0div" name="hamtype0div" style="display:none;">
            <label></label>
            <div class="infotipdiv">
                Published topics : <br>
                <b>/$label$</b> : all labels received from the counter<br>
            </div>
        </div>

        <div class="pure-control-group">
            <label for="hamport">Port</label>
            <input type='number' id='hamport' name='hamport' min='1' max='65535'>
        </div>
        <div class="pure-control-group">
            <label for="hamu">Username</label>
            <input type='text' id='hamu' name='hamu' maxlength='64' placeholder="optional">
        </div>
        <div class="pure-control-group">
            <label for="hamp">Password</label>
            <input type='password' id='hamp' name='hamp' maxlength='64' placeholder="optional">
        </div>

        <div id='hamgbte'>
            <div class="pure-control-group">
                <label for="hamgbt">Base Topic</label>
                <input type='text' id='hamgbt' name='hamgbt' maxlength='64'>
                <span id="hamgbti" name="hamgbti" class="infotip">?</span>
            </div>

            <div class="pure-control-group" id="hamgbtidiv" name="hamgbtidiv" style="display:none;">
                <label></label>
                <div class="infotipdiv">
                    Base Topic placeholders : <br>
                    <b>$adco$</b> : serial number of the counter<br>
                    <b>$sn$</b> : Serial Number of this device<br>
                    <b>$mac$</b> : WiFi MAC address of this device<br>
                    <b>$model$</b> : Model of this device<br>
                    Ex : DomoChip/<b>$adco$</b>
                </div>
            </div>
        </div>
    </div>
</div>

        <div class="pure-controls">
            <input type='submit' value='Save' class="pure-button pure-button-primary" disabled>
        </div>
    </fieldset>
</form>
<span id='r1'></span>

<script>

    $("#hai").addEventListener('click',function(){
        $("#haidiv").style.display=($("#haidiv").style.display==''?'none':'');
    });

    $("#haproto").addEventListener('change',function(){
        switch($("#haproto").value){
            case "0":
                $("#hae").style.display='none';
                break;
            case "1":
                $("#hae").style.display='';
                $("#hahe").style.display='';
                $("#hame").style.display='none';
                break;
            case "2":
                $("#hae").style.display='';
                $("#hahe").style.display='none';
                $("#hame").style.display='';
                break;
        }
    });

    $("#hahtype").addEventListener('change',function(){
        switch($("#hahtype").value){
            case "0":
                $("#hah0").style.display='';
                $("#hah1").style.display='none';
                break;
            case "1":
                $("#hah0").style.display='none';
                $("#hah1").style.display='';
                break;
        }
    });
    $("#hahgupi").addEventListener('click',function(){
        $("#hahgupidiv").style.display=($("#hahgupidiv").style.display==''?'none':'');
        });

    $("#hamtype").addEventListener('change',function(){
        switch($("#hamtype").value){
            case "0":
                $("#hamgbte").style.display='';
                break;
        }
    });
    $("#hamtype0i").addEventListener('click',function(){
        $("#hamtype0div").style.display=($("#hamtype0div").style.display==''?'none':'');
        });
    $("#hamgbti").addEventListener('click',function(){
        $("#hamgbtidiv").style.display=($("#hamgbtidiv").style.display==''?'none':'');
        });

    $("#hatls").addEventListener('change',function(){
        if($("#hatls").checked){
            $("#hahtlse").style.display='';
            $("#hamport").value=8883;
        }
        else{
            $("#hahtlse").style.display='none';
            $("#hamport").value=1883;
        }
    });

    $("#f1").addEventListener('submit',function(event){
        $("#r1").innerHTML="Saving Configuration...";
        post("/sc1",
            new FormData($("#f1")),
            function(){ 
                $("#f1").style.display='none';

                $('#r1').innerHTML='<h3><b>Configuration saved <span style="color: green;">successfully</span>.</b></h3>This page will be reloaded in <span id="cd">5</span>sec.';
                runScript('var count=4;var cdi=setInterval(function(){$("#cd").innerText=count;if(!count){clearInterval(cdi);location.reload();}count--;},1000);');
            },
            function(){
                $('#r1').innerHTML='<h3><b>Configuration <span style="color: red;">error</span>.</b></h3>';
            }
        );
        event.preventDefault();
    });

    getJSON("/gc1",
        function(GC1){
            for(k in GC1){
                if($('#'+k)){
                    if($('#'+k).type!='checkbox') $('#'+k).value=GC1[k];
                    else $('#'+k).checked=GC1[k];

                    triggerEvent($('#'+k),'change');
                }
            }

            $("#f1 input[type=submit]").disabled=false;
            fadeOut($("#l1"));
        },
        function(){
            $("#l1").innerHTML='<h6 style="display:inline;color:red;"><b> Failed</b></h6>';
        }
    );
</script>